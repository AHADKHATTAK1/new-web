

{%- style -%}
  .promo-bar {
    background: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
  }
{%- endstyle -%}

<div class="promo-bar" style="padding: 12px 20px; text-align: center; position: relative; overflow: hidden;">
  <div class="promo-bar__content" style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap; position: relative; z-index: 1;">
    
    {%- unless section.settings.icon == blank -%}
      <span style="font-size: 1.5rem;">{{ section.settings.icon }}</span>
    {%- endunless -%}
    
    <div style="font-weight: 600; font-size: 14px; letter-spacing: 0.5px;">
      {{ section.settings.text | escape }}
      
      {%- if section.settings.show_countdown -%}
        <span id="promoCountdown" style="margin-left: 10px; padding: 4px 12px; background: rgba(255,255,255,0.2); border-radius: 20px; font-weight: 700;">
          <span class="countdown-timer"></span>
        </span>
      {%- endif -%}
    </div>
    
    {%- if section.settings.button_text != blank -%}
      <a href="{{ section.settings.button_link }}" style="background: {{ section.settings.button_color }}; color: {{ section.settings.button_text_color }}; padding: 8px 20px; border-radius: 20px; text-decoration: none; font-weight: 700; font-size: 13px; transition: all 0.3s; display: inline-block;">
        {{ section.settings.button_text }}
      </a>
    {%- endif -%}
    
  </div>
  
  <!-- Animated background pattern -->
  <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1; overflow: hidden; pointer-events: none;">
    <div style="position: absolute; width: 200%; height: 200%; background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px); animation: slide 20s linear infinite;"></div>
  </div>
</div>

{%- if section.settings.show_countdown -%}
<script>
  (function() {
    const endDate = new Date('{{ section.settings.countdown_date }}').getTime();
    
    function updateCountdown() {
      const now = new Date().getTime();
      const distance = endDate - now;
      
      if (distance < 0) {
        document.querySelector('.countdown-timer').textContent = 'Offer Ended';
        return;
      }
      
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
      let countdownText = '';
      if (days > 0) countdownText += days + 'd ';
      countdownText += hours + 'h ' + minutes + 'm ' + seconds + 's';
      
      document.querySelector('.countdown-timer').textContent = countdownText;
    }
    
    if (document.querySelector('.countdown-timer')) {
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }
  })();
</script>
{%- endif -%}

<style>
  @keyframes slide {
    0% { transform: translate(0, 0); }
    100% { transform: translate(-50%, -50%); }
  }
  
  .promo-bar a:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
</style>

{% schema %}
{
  "name": "Promotional Top Bar",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "text",
      "label": "Promotional text",
      "default": "ðŸŽ‰ FLASH SALE: 50% OFF Everything - Limited Time Only!"
    },
    {
      "type": "text",
      "id": "icon",
      "label": "Icon (emoji or symbol)",
      "default": "ðŸ”¥"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ff6b6b"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Countdown Timer"
    },
    {
      "type": "checkbox",
      "id": "show_countdown",
      "label": "Show countdown timer",
      "default": true
    },
    {
      "type": "text",
      "id": "countdown_date",
      "label": "End date (YYYY-MM-DD HH:MM)",
      "default": "2026-12-31 23:59",
      "info": "24-hour format"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link",
      "default": "/collections/all"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Promotional Top Bar",
      "settings": {
        "text": "ðŸŽ‰ FLASH SALE: 50% OFF Everything!",
        "icon": "ðŸ”¥",
        "show_countdown": true,
        "button_text": "Shop Now"
      }
    }
  ]
}
{% endschema %}
